import{Q as F}from"./QPage.3f0f7285.js";import{_ as Y}from"./PostList.be4ad63d.js";import X from"./PostHeader.f57c5fe7.js";import z from"./PostLeftBar.4b071e3b.js";import G from"./PostRightBar.956df5da.js";import{a as J}from"./QItemLabel.7d6fabb5.js";import{u as U,a4 as y,an as N,o as x,i as C,k as q,j as c,ao as K,ai as Z,a as ee,ac as H,aj as te,ap as oe,aq as se,ar as w,y as ne,as as re,at as ae,E as S,au as k,av as le,a7 as A,aw as O,ax as P,ay as ue,az as ie,H as ce,aa as fe,aA as V,aB as de,aC as me,aD as pe,_ as ve,d as T,c as $,F as ge,aE as W,e as ye}from"./index.5dab455f.js";import{_ as _e}from"./PostForm.3faf4f12.js";import{c as we,g as he}from"./post.328ce0bc.js";import{Q as M}from"./useBookmark.1ce185b5.js";import"./QChip.7b90b6fa.js";import"./user.faff4df2.js";import"./uid.42677368.js";import"./rtl.b51694b1.js";import"./StickySideBar.09f2d587.js";import"./category.058bffc4.js";import"./QInput.8657458d.js";import"./useTags.270b218a.js";import"./QCardActions.882ea4ec.js";import"./QForm.a192e15e.js";import"./index.7afb556f.js";import"./validate-rules.6596e294.js";const b=()=>({title:"",category:"",content:"",tags:[]}),Se={__name:"PostWriteDialog",emits:["complete"],setup(e,{emit:t}){const o=t,r=U(),s=y(b()),n=()=>{s.value=b()},{isLoading:d,execute:l}=N(we,null,{immediate:!1,throwError:!0,onSuccess:i=>{o("complete")}});return(i,u)=>(x(),C(re,ne({persistent:""},i.$attrs,{onHide:n}),{default:q(()=>[c(K,{style:{minWidth:"660px"}},{default:q(()=>[c(Z,null,{default:q(()=>[c(J,null,{default:q(()=>[ee("\uAE00\uC4F0\uAE30")]),_:1}),H(c(te,{flat:"",round:"",dense:"",icon:"close"},null,512),[[oe]])]),_:1}),c(se),c(_e,{title:s.value.title,"onUpdate:title":u[0]||(u[0]=a=>s.value.title=a),category:s.value.category,"onUpdate:category":u[1]||(u[1]=a=>s.value.category=a),content:s.value.content,"onUpdate:content":u[2]||(u[2]=a=>s.value.content=a),tags:s.value.tags,"onUpdate:tags":u[3]||(u[3]=a=>s.value.tags=a),loading:w(d),onSubmit:u[4]||(u[4]=a=>w(l)(1e3,{...s.value,uid:w(r).uid}))},null,8,["title","category","content","tags","loading"])]),_:1})]),_:1},16))}};function I(e){var t;const o=k(e);return(t=o==null?void 0:o.$el)!=null?t:o}const j=ie?window:void 0;function ke(...e){let t,o,r,s;if(typeof e[0]=="string"||Array.isArray(e[0])?([o,r,s]=e,t=j):[t,o,r,s]=e,!t)return O;Array.isArray(o)||(o=[o]),Array.isArray(r)||(r=[r]);const n=[],d=()=>{n.forEach(a=>a()),n.length=0},l=(a,f,_,g)=>(a.addEventListener(f,_,g),()=>a.removeEventListener(f,_,g)),i=A(()=>[I(t),k(s)],([a,f])=>{if(d(),!a)return;const _=de(f)?{...f}:f;n.push(...o.flatMap(g=>r.map(p=>l(a,g,p,_))))},{immediate:!0,flush:"post"}),u=()=>{i(),d()};return P(u),u}function De(){const e=y(!1);return ce()&&fe(()=>{e.value=!0}),e}function qe(e){const t=De();return S(()=>(t.value,Boolean(e())))}function B(e,t,o={}){const{root:r,rootMargin:s="0px",threshold:n=.1,window:d=j,immediate:l=!0}=o,i=qe(()=>d&&"IntersectionObserver"in d),u=S(()=>{const p=k(e);return(Array.isArray(p)?p:[p]).map(I).filter(le)});let a=O;const f=y(l),_=i.value?A(()=>[u.value,I(r),f.value],([p,L])=>{if(a(),!f.value||!p.length)return;const v=new IntersectionObserver(t,{root:I(L),rootMargin:s,threshold:n});p.forEach(m=>m&&v.observe(m)),a=()=>{v.disconnect(),a=O}},{immediate:l,flush:"post"}):O,g=()=>{a(),_(),f.value=!1};return P(g),{isSupported:i,isActive:f,pause(){a(),f.value=!1},resume(){f.value=!0},stop:g}}function Q(e){return typeof Window!="undefined"&&e instanceof Window?e.document.documentElement:typeof Document!="undefined"&&e instanceof Document?e.documentElement:e}const xe={[ae.mounted](e,t){typeof t.value=="function"?B(e,t.value):B(e,...t.value)}};function R(e){const t=window.getComputedStyle(e);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&e.clientWidth<e.scrollWidth||t.overflowY==="auto"&&e.clientHeight<e.scrollHeight)return!0;{const o=e.parentNode;return!o||o.tagName==="BODY"?!1:R(o)}}function Ae(e){const t=e||window.event,o=t.target;return R(o)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const E=new WeakMap;function Ee(e,t=!1){const o=y(t);let r=null,s;A(ue(e),l=>{const i=Q(k(l));if(i){const u=i;E.get(u)||E.set(u,s),o.value&&(u.style.overflow="hidden")}},{immediate:!0});const n=()=>{const l=Q(k(e));!l||o.value||(V&&(r=ke(l,"touchmove",i=>{Ae(i)},{passive:!1})),l.style.overflow="hidden",o.value=!0)},d=()=>{var l;const i=Q(k(e));!i||!o.value||(V&&(r==null||r()),i.style.overflow=(l=E.get(i))!=null?l:"",E.delete(i),o.value=!1)};return P(d),S({get(){return o.value},set(l){l?n():d()}})}function Oe(){let e=!1;const t=y(!1);return(o,r)=>{if(t.value=r.value,e)return;e=!0;const s=Ee(o,r.value);A(t,n=>s.value=n)}}Oe();const $e=()=>{const e=me(),t=pe(),o=S({get:()=>e.query.category||"",set:n=>t.push({query:{...e.query,category:n||void 0}})}),r=S({get:()=>e.query.sort||"createAt",set:n=>t.push({query:{...e.query,sort:n}})}),s=S({get:()=>{var n;return((n=e.query.tags)==null?void 0:n.split(","))||[]},set:n=>t.push({query:{...e.query,tags:n.length===0?void 0:n.join(",")}})});return{category:o,sort:r,tags:s}},Ie={},Le={class:"q-pa-md"},We={class:"q-gutter-y-md"};function Me(e,t){return x(),T("div",Le,[$("div",We,[c(M,{type:"circle"}),c(M),c(M,{square:""})])])}var D=ve(Ie,[["render",Me]]);const Qe={__name:"PostListSkeleton",setup(e){return(t,o)=>(x(),T(ge,null,[c(D),c(D),c(D),c(D),c(D)],64))}},Ce={class:"row q-col-gutter-x-lg"},Pe={class:"col-7"},rt={__name:"index",setup(e){const t=U(),{category:o,sort:r,tags:s}=$e(),n=S(()=>({category:o.value,tags:s.value,sort:r.value,limit:6})),d=y([]),l=y(null),i=y(!0),{execute:u,isLoading:a}=N(he,[],{immediate:!1,throwError:!0,onSuccess:v=>{l.value?d.value=d.value.concat(v.items):d.value=v.items,i.value=v.items.length>=n.value.limit,l.value=v.lastItem}});A(n,()=>{l.value=null,u(0,n.value)},{deep:!0});const f=y(!1),_=()=>{if(!t.isAuthentication){alert("\uB85C\uADF8\uC778 \uD6C4 \uC774\uC6A9 \uAC00\uB2A5\uD569\uB2C8\uB2E4.");return}if(!t.user.emailVerified){alert("\uC774\uBA54\uC77C \uC778\uC99D \uD6C4 \uC774\uC6A9 \uAC00\uB2A5\uD569\uB2C8\uB2E4.");return}f.value=!0},g=()=>{f.value=!1,l.value=null,u(0,n.value)},p=()=>{u(0,{...n.value,start:l.value})},L=([{isIntersecting:v}])=>{v&&i.value&&p()};return(v,m)=>(x(),C(F,{padding:""},{default:q(()=>[$("div",Ce,[c(z,{class:"col-grow",category:w(o),"onUpdate:category":m[0]||(m[0]=h=>W(o)?o.value=h:null)},null,8,["category"]),$("section",Pe,[c(X,{sort:w(r),"onUpdate:sort":m[1]||(m[1]=h=>W(r)?r.value=h:null)},null,8,["sort"]),w(a)?(x(),C(Qe,{key:0})):ye("",!0),c(Y,{items:d.value},null,8,["items"]),H($("div",null,null,512),[[w(xe),L]])]),c(G,{class:"col-3",tags:w(s),"onUpdate:tags":m[2]||(m[2]=h=>W(s)?s.value=h:null),onOpenWriteDialog:_},null,8,["tags"])]),c(Se,{modelValue:f.value,"onUpdate:modelValue":m[3]||(m[3]=h=>f.value=h),onComplete:g},null,8,["modelValue"])]),_:1}))}};export{rt as default};
